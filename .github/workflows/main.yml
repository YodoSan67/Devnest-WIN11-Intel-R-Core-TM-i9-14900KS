name: 'Deploy Windows Environment'

on:
  workflow_dispatch:
    inputs:
      GIST_URL:
        description: 'https://gist.githubusercontent.com/ditzz-dev/ea7d0ddc8b8e1a46f98bf9117faf99e2/raw/b0804ba3c6625e3c2eaeb6074e633878f68d8baf/setup-windows.ps1'
        required: true

jobs:
  build:
    runs-on: windows-11-arm
    timeout-minutes: 360
    
    steps:
      - name: 'ðŸ“¥ Download Master Script'
        shell: powershell
        run: |
          if (-not "${{ github.event.inputs.GIST_URL }}") {
            Write-Error "FATAL: Please provide a Gist URL to run this workflow."
            exit 1
          }
          Write-Host "-> Downloading master script from Gist..."
          Invoke-WebRequest -Uri "${{ github.event.inputs.GIST_URL }}" -OutFile "setup.ps1"

      - name: 'ðŸš€ Execute RDP Deployment Script'
        shell: powershell
        run: |
          if (-not "${{ secrets.NGROK_AUTH_TOKEN }}") {
            Write-Error "FATAL: Secret 'NGROK_AUTH_TOKEN' not found. Please set it in repository Settings > Secrets."
            exit 1
          }
          Write-Host "-> Secret validated. Executing deployment script..."
          .\setup.ps1 -NgrokAuthToken "${{ secrets.NGROK_AUTH_TOKEN }}"

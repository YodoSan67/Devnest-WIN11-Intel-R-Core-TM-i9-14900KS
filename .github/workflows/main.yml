name: 'Deploy Windows Environment'

on:
  workflow_dispatch:
    inputs:
      GIST_URL:
        description: 'URL RAW dari skrip PowerShell Gist Anda'
        required: true

jobs:
  build:
    runs-on: windows-11-arm
    timeout-minutes: 360
    
    steps:
      - name: 'ðŸ“¥ Download Master Script'
        shell: powershell
        run: |
          if (-not "${{ github.event.inputs.GIST_URL }}") {
            Write-Error "FATAL: Please provide a Gist URL to run this workflow."
            exit 1
          }
          Write-Host "-> Downloading master script from Gist..."
          Invoke-WebRequest -Uri "${{ github.event.inputs.GIST_URL }}" -OutFile "setup.ps1"

      - name: 'ðŸš€ Execute RDP Deployment Script'
        shell: powershell
        run: |
          if (-not "${{ secrets.NGROK_AUTH_TOKEN }}") {
            Write-Error "FATAL: Secret 'NGROK_AUTH_TOKEN' not found. Please set it in repository Settings > Secrets."
            exit 1
          }
          Write-Host "-> Secret validated. Executing deployment script..."
          .\setup.ps1 -NgrokAuthToken "${{ secrets.NGROK_AUTH_TOKEN }}"
